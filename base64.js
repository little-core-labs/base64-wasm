
module.exports = loadWebAssembly

loadWebAssembly.supported = typeof WebAssembly !== 'undefined'

function loadWebAssembly (opts) {
  if (!loadWebAssembly.supported) return null

  var imp = opts && opts.imports
  var wasm = toUint8Array('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')
  var ready = null

  var mod = {
    buffer: wasm,
    memory: null,
    exports: null,
    realloc: realloc,
    onload: onload
  }

  onload(function () {})

  return mod

  function realloc (size) {
    mod.exports.memory.grow(Math.max(0, Math.ceil(Math.abs(size - mod.memory.length) / 65536)))
    mod.memory = new Uint8Array(mod.exports.memory.buffer)
  }

  function onload (cb) {
    if (mod.exports) return cb()

    if (ready) {
      ready.then(cb.bind(null, null)).catch(cb)
      return
    }

    try {
      if (opts && opts.async) throw new Error('async')
      setup({instance: new WebAssembly.Instance(new WebAssembly.Module(wasm), imp)})
    } catch (err) {
      ready = WebAssembly.instantiate(wasm, imp).then(setup)
    }

    onload(cb)
  }

  function setup (w) {
    mod.exports = w.instance.exports
    mod.memory = mod.exports.memory && mod.exports.memory.buffer && new Uint8Array(mod.exports.memory.buffer)
  }
}

function toUint8Array (s) {
  if (typeof atob === 'function') return new Uint8Array(atob(s).split('').map(charCodeAt))
  return (require('buf' + 'fer').Buffer).from(s, 'base64')
}

function charCodeAt (c) {
  return c.charCodeAt(0)
}
